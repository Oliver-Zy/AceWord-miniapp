<import src="/templates/mine.wxml" />
<!-- template -->

<!-- S container -->
<view class="container">
  <!-- <view wx:if="{{showOfficialAccount}}" style="position: fixed;bottom:78px;z-index: 999;left: 0;width: 100vw;">
    <official-account binderror="error"></official-account>
  </view> -->
  <scroll-view scroll-y="true" style="width:100%;height:{{scrollViewHeight}}px;position:fixed;top:{{naviBarHeight}}px;" bind:scroll="onScroll">
    <view style="height:14px;"></view>
    <view class="up-container">
      <template is="avatar-bar" data="{{avatarUrl, nickName, vipExpireDate}}" />
      <template is="statistic-bar" data="{{learningInfo}}" />
    </view>
    <view class="down-container">

      <template is="cell-group" data="{{cellInfo: cellInfo_1, isDarkMode: isDarkMode}}" />
      <view style="width:100%;height:8px;margin-top:6px;background-color:{{isDarkMode ? '#1B1C2D' : '#F7F8FA'}};"></view>

      <template is="cell-group" data="{{cellInfo: cellInfo_2, isDarkMode: isDarkMode}}" />
      <view class="cell-group">
        <view class="cell" bindtap="onCell" data-type="notif">
          <view>
            <image src="/images/cell-icons/{{isDarkMode ? 'notif-dark' : 'notif' }}.png"></image>
            <text>订阅复习提醒</text>
          </view>
          <view style="display: flex;justify-content: flex-end;align-items: center;">
            <image class="right-img" style="width: 16px;height: 16px;padding-right: 0;" src="./images/right.png"></image>
          </view>
        </view>
      </view>
      <view style="width:100%;height:8px;margin-top:6px;background-color:{{isDarkMode ? '#1B1C2D' : '#F7F8FA'}};"></view>
      <template is="cell-group" data="{{cellInfo: cellInfo_3, isDarkMode: isDarkMode}}" />
      <view style="width:100%;height:28px;"></view>
    </view>
    <!-- E down-container -->

  </scroll-view>
</view>
<!-- E container -->

<!-- S ace-components -->
<ace-navi-bar type="calendar" title="我的" showDivider="{{showNaviBarDivider}}" style="width:100%;position:fixed;top:0;" />
<ace-popup wx:if="{{ showNotifPanel }}" type="notif" style="width:100%;position:fixed;bottom:0;z-index:98;" bind:triggerCondition="onTriggerCondition" bind:triggerTime="onTriggerTime" />
<!-- E ace-components -->

<!-- S vant-components -->
<van-toast id="van-toast" />
<van-popup show="{{ showPopupVant }}" position="bottom" overlay="{{ false }}" duration="0" bind:close="onClose">
  <van-action-sheet show="{{ showActionSheet }}" description="{{ actionSheetDesc }}" actions="{{ actions }}" cancel-text="取消" bind:select="onSelectActionSheet" bind:cancel="onCancelActionSheet" bind:click-overlay="onCancelActionSheet" />
</van-popup>
<!-- 订阅提醒弹窗 -->
<van-popup show="{{ showDateTimePicker }}" round position="bottom" overlay="{{ true }}" bind:close="onDateTimePickerCancel" custom-class="notification-popup">
  <view class="notification-popup-content">
    <!-- 弹窗头部 -->
    <view class="popup-header">
      <view class="popup-title">订阅复习提醒</view>
      <view class="popup-subtitle">设置每日复习提醒时间</view>
    </view>
    
    <!-- 开关设置 -->
    <view class="popup-section">
      <view class="setting-item">
        <view class="setting-label">
          <image class="setting-icon" src="/images/cell-icons/{{isDarkMode ? 'notif-dark' : 'notif' }}.png"></image>
          <text class="setting-text">开启消息提醒</text>
        </view>
        <van-switch checked="{{openNotification}}" bind:change="onChange" size="20" active-color="#6366F1"></van-switch>
      </view>
    </view>

    <!-- 时间选择 -->
    <view class="popup-section" wx:if="{{openNotification}}">
      <view class="section-title">提醒时间</view>
      <view class="time-picker-container">
        <van-datetime-picker 
          show-toolbar="{{false}}" 
          type="time" 
          value="{{ currentTime }}" 
          bind:input="onDateTimePickerInput" 
          bind:confirm="onDateTimePickerConfirm" 
          bind:cancel="onDateTimePickerCancel"
          custom-class="custom-time-picker" />
      </view>
    </view>

    <!-- 功能按钮 -->
    <view class="popup-section">
      <view class="action-buttons">
        <view class="action-button" bind:tap="navigateToGZH">
          <image class="action-icon" src="/images/icons/{{isDarkMode ? 'wechat-dark' : 'wechat'}}.png"></image>
          <text class="action-text">关注公众号</text>
          <text class="action-desc">接收提醒消息</text>
        </view>
        <view class="action-button" bind:tap="testNotify">
          <image class="action-icon" src="/images/icons/{{isDarkMode ? 'test-dark' : 'test'}}.png"></image>
          <text class="action-text">测试提醒</text>
          <text class="action-desc">验证接收状态</text>
        </view>
      </view>
    </view>

    <!-- 确认按钮 -->
    <view class="popup-footer">
      <ace-button size="large" text="确定" bind:btnEvent="onConfirmChangeNotification" />
    </view>
  </view>
</van-popup>

<van-overlay show="{{ showOverlay }}" bind:click="onClickHideOverlay" />
<van-overlay show="{{ showOverlayZIndex }}" z-index="{{zIndex}}" bind:click="onClickHideOverlay" />
<!-- E vant-components -->

<view wx:if="{{ showTabBarShadow }}" class="tab-bar-shadow" style="padding-bottom: {{isIOS ? 30 : 0}}px;"></view>
<!-- tab-bar-shadow -->