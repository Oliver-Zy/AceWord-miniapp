<wxs module="tools" src="./wordbook-detail.wxs"></wxs>

<!-- S container -->
<view class="container">

  <!-- S scroll-view -->
  <scroll-view 
    scroll-y="true" 
    style="height:{{scrollViewHeight}}px;position:fixed;top:{{naviBarHeight}}px;">
    
    <!-- S sub-categories -->
    <view style="height: 16px;"></view>
    
    <block wx:for="{{subCategories}}" wx:key="subCategory">
      <view class="subcategory-card">
        <van-collapse 
          value="{{ activeNames }}" 
          bind:change="onCollapseChange"
          border="{{ false }}">
          
          <van-collapse-item 
            title="{{item.subCategoryName}}" 
            name="{{item.subCategory}}"
            custom-class="collapse-item">
            
            <view slot="value" class="subcategory-count">{{item.books.length}}本词书</view>
            
            <!-- S wordbook list -->
            <van-cell-group custom-class="wordbook-group">
              <block wx:for="{{item.books}}" wx:for-item="book" wx:key="wordBookCode">
                
                <van-cell 
                  title="{{book.wordBookName}}"
                  value="{{tools.formatProgress(book.userProgressNum, book.totalWordNum)}}"
                  label="{{book.totalWordNum}}个单词 · {{book.userNum}}人在学"
                  is-link
                  custom-class="wordbook-cell {{book.wordBookCode === currentWordBookCode ? 'current-wordbook' : ''}}"
                  bind:click="onSelectWordBook"
                  data-book="{{book}}">
                  
                  <!-- S right content -->
                  <view slot="right-icon" class="book-tags">
                    <van-tag 
                      wx:if="{{book.isOfficial}}" 
                      type="primary" 
                      size="mini" 
                      plain>官方</van-tag>
                    <van-tag 
                      wx:if="{{book.isHot}}" 
                      type="warning" 
                      size="mini" 
                      plain>热门</van-tag>
                    <van-tag 
                      wx:if="{{book.isNew}}" 
                      type="success" 
                      size="mini" 
                      plain>新书</van-tag>
                  </view>
                  <!-- E right content -->
                  
                </van-cell>
                
              </block>
            </van-cell-group>
            <!-- E wordbook list -->
            
          </van-collapse-item>
          
        </van-collapse>
      </view>
      
      <view style="height: 12px;"></view>
    </block>
    <!-- E sub-categories -->
    
    <!-- S empty state -->
    <view wx:if="{{isLoaded && subCategories.length === 0}}" class="empty-state">
      <van-empty description="该分类下暂无词书" />
    </view>
    <!-- E empty state -->
    
    <view style="height: 30px;"></view>
    
  </scroll-view>
  <!-- E scroll-view -->

</view>
<!-- E container -->

<!-- S ace components -->
<ace-navi-bar 
  type="back" 
  title="{{categoryName}}" 
  showDivider="{{showNaviBarDivider}}" 
  style="width:100%;position:fixed;top:0;" />
<!-- E ace components -->

<!-- S vant components -->
<van-toast id="van-toast" />
<van-dialog id="van-dialog" />
<!-- E vant components -->
