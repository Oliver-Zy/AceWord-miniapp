<wxs module="tools" src="./vip.wxs"></wxs>
<!-- wxs -->

<!-- S container -->
<view class="container">

  <!-- S background-container -->
  <view class="background-container" style="width:{{bgContainerWidth}}px;height:{{bgContainerHeight}}px;position:fixed;top:{{naviBarHeight + 16}}px;">
    <view class="avatar-group">
      <image class="avatar-img" src="{{avatarUrl == null ? '/pages/mine/images/avatar.png' : avatarUrl}}"></image>
      <view class="right-avatar-group">
        <text class="right-avatar-group-text">{{nickName == '' ? '修改昵称' : nickName}}</text>
        <view class="down-right-avatar-group">
          <text class="down-right-avatar-group-text">{{vipExpireDate == '00000000' ? '尚未开通会员' : '有效期至' + tools.formatCreateDate(vipExpireDate)}}</text>
        </view>
      </view>
    </view>
    <image src="./images/background.png" style="width:{{bgContainerWidth}}px;height:{{bgContainerHeight}}px;" class="background-img"></image>
  </view>
  <!-- E background-container -->

  <!-- S scroll-view -->
  <scroll-view scroll-y="true" enhanced="{{true}}" show-scrollbar="{{false}}" style="padding:24px 16px 0 16px;height:{{scrollViewHeight}}px;position:fixed;top:{{naviBarHeight + 16 + 120}}px;background:#fff;border-radius:16px;box-sizing:border-box;">
    <text class="title-text">选择会员档位</text>
    <view style="height:20px;"></view>
    
    <!-- 会员档位选择 -->
    <view class="vip-plans-container">
      <view 
        wx:for="{{vipPlans}}" 
        wx:key="id" 
        class="vip-plan-card {{chosenIndex === index ? 'selected' : ''}}"
        data-index="{{index}}"
        bind:tap="onPriceBlock"
      >
        <!-- 选中标签 -->
        <image wx:if="{{chosenIndex === index}}" class="selected-corner" src="/images/icons/corner.png"></image>
        
        <!-- 会员标题 -->
        <view class="plan-title">{{item.title}}</view>
        
        <!-- 价格区域 -->
        <view class="plan-price-area">
          <text class="plan-currency">￥</text>
          <text class="plan-price">{{item.price}}</text>
        </view>
        
        <!-- 标签 -->
        <view class="savings-badge {{item.badgeText === '无优惠' ? 'experience-badge' : ''}}">
          <text class="savings-text">{{item.badgeText}}</text>
        </view>
        
        <!-- 原价 -->
        <view wx:if="{{item.originalPrice}}" class="original-price">原价￥{{item.originalPrice}}</view>
      </view>
    </view>



    <view style="height:24px;"></view>
    <view class="pay-btn" bind:tap="onPay">
      <text class="pay-btn-text">立即以￥{{vipPlans[chosenIndex].price}}开通</text>
    </view>
    <view style="padding-top:12px;width:100%;display:flex;justify-content:center;">
      <text style="font-size:14px;color:#787878;">开通会员代表接受</text>
      <text style="font-size:14px;color:#FAB220;" bind:tap="onVipProtocol">《会员协议》</text>
    </view>

    <!-- <view wx:if="{{ !isIOS }}" style="height:24px;"></view> -->
    <view style="height:24px;"></view>
    <text class="title-text">会员特权</text>
    <view style="height:20px;"></view>

    <!-- 核心特权 -->
    <view class="feature-container">
      <image src="./images/feature-1.png" style="width:40px;height:40px;"></image>
      <view style="width:14px;"></view>
      <view class="right-feature-container">
        <text class="feature-title">无限卡片创建</text>
        <view style="height:2px;"></view>
        <text class="feature-desc">告别每日10张限制，想学多少学多少</text>
      </view>
    </view>

    <view style="height:24px;"></view>
    <view class="feature-container">
      <image src="./images/feature-2.png" style="width:40px;height:40px;"></image>
      <view style="width:14px;"></view>
      <view class="right-feature-container">
        <text class="feature-title">智能复习节奏</text>
        <view style="height:2px;"></view>
        <text class="feature-desc">自定义复习倒计时，打造专属学习节奏</text>
      </view>
    </view>

    <view style="height:24px;"></view>
    <view class="feature-container">
      <image src="./images/feature-4.png" style="width:40px;height:40px;"></image>
      <view style="width:14px;"></view>
      <view class="right-feature-container">
        <text class="feature-title">精美英文字体</text>
        <view style="height:2px;"></view>
        <text class="feature-desc">8种专业字体随心切换，让学习更赏心悦目</text>
      </view>
    </view>
    <view style="height:24px;padding-bottom:env(safe-area-inset-bottom);"></view>
  </scroll-view>
  <!-- E scroll-view -->

</view>
<!-- S container -->

<!-- S ace-components -->
<ace-navi-bar type="vip" title="开通会员" backgroundColor="rgba(0,0,0,0)" style="width:100%;position:fixed;top:0;" />
<!-- E ace-components -->

<!-- S vant components -->
<van-toast id="van-toast" />
<!-- E vant components -->