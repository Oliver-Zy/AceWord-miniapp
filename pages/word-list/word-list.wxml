<wxs module="tools" src="./word-list.wxs"></wxs>

<!-- S container -->
<view class="container">

  <!-- S scroll-view -->
  <scroll-view 
    scroll-y="true" 
    refresher-enabled="true" 
    refresher-triggered="{{isRefresherTriggered}}" 
    style="height:{{scrollViewHeight}}px;position:fixed;top:{{naviBarHeight}}px;" 
    bind:refresherrefresh="onScrollViewRefresh">
    
    <!-- S header -->
    <view style="height: 20px;"></view>
    <ace-header 
      wx:if="{{wordGroupsByDate.length > 0}}" 
      titleType="textWithCount" 
      text="已练习" 
      arrLen="{{tools.getTotalWordCount(wordGroupsByDate)}}" 
      iconType="selectAll" 
      isSelectAll="{{selectedWordIds.length === tools.getTotalWordCount(wordGroupsByDate) && tools.getTotalWordCount(wordGroupsByDate) > 0}}"
      bind:headerEvent="onHeaderEvent" />
    <!-- E header -->

    <!-- S word list -->
    <view wx:if="{{tools.getTotalWordCount(wordGroupsByDate) > 0}}" class="word-list-container">
      <block wx:for="{{wordGroupsByDate}}" wx:key="date" wx:for-item="dateGroup">
        <block wx:for="{{dateGroup.wordList}}" wx:key="wordId" wx:for-item="wordItem" wx:for-index="wordIndex">
          <view class="word-item" 
                bind:tap="onMeaningTap" 
                data-word-id="{{wordItem.wordId}}"
                hover-class="none">
            <!-- S word item content -->
            <view class="word-item-content">
              <!-- S left content -->
              <view class="word-item-left">
                <view class="word-name" catchtap="onWordItemTap" data-date-index="{{index}}" data-word-index="{{wordIndex}}" hover-class="none">{{wordItem.wordName}}</view>              
                <view class="meaning-text {{visibleMeanings[wordItem.wordId] ? '' : 'blurred'}}">
                  {{wordItem.selfDef || wordItem.wordCN || '暂无释义'}}
                </view>
              </view>
              <!-- E left content -->

              <!-- S right content -->
              <view class="word-item-right">
                <view class="proficiency-text">{{wordItem.proficiencyText}}</view>
              </view>
              <!-- E right content -->
            </view>
            <!-- E word item content -->

            <!-- S divider -->
            <view wx:if="{{!(index === wordGroupsByDate.length - 1 && wordIndex === dateGroup.wordList.length - 1)}}" class="divider"></view>
            <!-- E divider -->
          </view>
        </block>
      </block>
    </view>
    <view style="height:22px;"></view>
    <!-- E word list -->
    
    <!-- S empty state -->
    <view wx:if="{{isLoaded && wordGroupsByDate.length == 0}}" class="empty-state">
      <view class="empty-text">暂无练习单词</view>
      <view class="empty-subtext">还没有练习记录</view>
    </view>
    <!-- E empty state -->

    <!-- S load more button -->
    <view wx:if="{{isLoaded && wordGroupsByDate.length > 0}}" style="padding:28px 0;display:flex;justify-content:center;align-items:center;gap:12px;">
      <ace-button size="small" text="{{isLoadingMore ? '加载中...' : '加载更多'}}" bind:btnEvent="onLoadMore" />
    </view>
    <!-- E load more button -->

    <view style="height:{{selectedWordIds.length != 0 ? 62 : 0}}px;"></view>
  </scroll-view>
  <!-- E scroll-view -->

</view>
<!-- E container -->

<!-- S practice button -->
<view wx:if="{{selectedWordIds.length != 0}}" style="display:flex;justify-content:center;position:absolute;left:50%;transform:translate(-50%);bottom:{{ isIOS ? 100 : 70}}px;overflow: hidden;">
  <ace-button size="large" text="开始练习" bind:btnEvent="onPractice" />
</view>
<!-- E practice button -->

<!-- S dic-card -->
<view style="position:fixed;bottom:0;z-index:3;">
  <dic-card id="dic-card" wx:if="{{showDicCard}}" wordInfo="{{wordInfo}}" showReplaceBtn="{{false}}" showStyleBtn="{{false}}" bind:dicCardEvent="onDicCardEvent" />
  <view style="height:100px;" bind:tap="onClickHideOverlay"></view>
</view>
<!-- E dic-card -->

<!-- S overlay -->
<view wx:if="{{showOverlay}}" class="overlay" bind:tap="onClickHideOverlay"></view>
<!-- E overlay -->

<!-- S ace components -->
<ace-navi-bar type="calendar" title="单词列表" backgroundColor="rgba(0,0,0,0)" showDivider="{{showNaviBarDivider}}" style="width:100%;position:fixed;top:0;" />
<!-- E ace components -->

<!-- S vant components -->
<van-toast id="van-toast" />
<!-- E vant components -->
