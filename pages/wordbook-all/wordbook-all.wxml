<wxs module="tools" src="./wordbook-all.wxs"></wxs>

<!-- S container -->
<view class="container">

  <!-- S scroll-view -->
  <scroll-view 
    scroll-y="true" 
    refresher-enabled="true" 
    refresher-triggered="{{isRefresherTriggered}}" 
    style="height:{{scrollViewHeight}}px;position:fixed;top:{{naviBarHeight}}px;" 
    bind:refresherrefresh="onScrollViewRefresh">
    
    <!-- S wordbook categories -->
    <view style="height: 16px;"></view>
    
    <!-- S search container -->
    <view class="search-container-fixed" wx:if="{{selectedCategoryCode !== '99'}}">
      <view class="search-box" bind:tap="onSearchBoxTap">
        <image class="search-icon" src="../../images/icons/search.png"></image>
        <text class="search-placeholder">搜索词书</text>
      </view>
    </view>
    <!-- E search container -->
    
    <!-- S search results -->
    <view wx:if="{{isSearching}}" class="search-results-container">
      <van-cell-group wx:if="{{searchResults.length > 0}}" custom-class="search-results-group">
        <block wx:for="{{searchResults}}" wx:for-item="book" wx:key="wordBookCode">
          <van-cell 
            title="{{book.wordBookName}}"
            value="{{tools.formatStudyStatus(book.userProgressNum, book.totalWordNum)}}"
            label="{{book.totalWordNum}}个单词 · 已学{{book.userProgressNum || 0}}个"
            is-link
            custom-class="wordbook-cell"
            data-book="{{book}}"
            bind:click="onSelectWordBook">
            
            <view slot="icon" class="wordbook-icon">
              <view class="status-dot" style="background-color: {{tools.getStatusColor(book.userProgressNum, book.totalWordNum)}};"></view>
            </view>
            
            <view slot="right-icon" class="wordbook-right">
              <view wx:if="{{book.wordBookCode === currentWordBookCode}}" class="current-tag">
                <van-tag type="primary" size="mini">当前</van-tag>
              </view>
              <image class="arrow-icon" src="../../images/icons/right.png"></image>
            </view>
            
          </van-cell>
        </block>
      </van-cell-group>
      
      <van-empty wx:if="{{searchResults.length === 0}}" 
        image="search" 
        description="未找到相关词书" />
    </view>
    <!-- E search results -->
    
    <block wx:if="{{!isSearching}}" wx:for="{{wordBookCategories}}" wx:key="categoryCode">
      <view class="category-card">
        <van-collapse 
          value="{{ activeNames }}" 
          bind:change="onCollapseChange"
          border="{{ false }}">
          
          <van-collapse-item 
            title="{{item.categoryName}}" 
            name="{{item.categoryCode}}"
            custom-class="collapse-item">
            
            <view slot="value" class="category-count">{{item.wordBooks.length}}本词书</view>
            
            <!-- S wordbook list -->
            <van-cell-group custom-class="wordbook-group">
              <block wx:for="{{item.wordBooks}}" wx:for-item="book" wx:key="wordBookCode">
                
                <van-cell 
                  title="{{book.wordBookName}}"
                  value="{{tools.formatStudyStatus(book.userProgressNum, book.totalWordNum)}}"
                  label="{{book.totalWordNum}}个单词 · 已学{{book.userProgressNum || 0}}个"
                  is-link
                  custom-class="wordbook-cell"
                  bind:click="onSelectWordBook"
                  data-book="{{book}}">
                  
                  <!-- S right content -->
                  <view slot="right-icon" class="book-tags">
                    <van-tag 
                      wx:if="{{book.isHot}}" 
                      type="warning" 
                      size="mini" 
                      plain>热门</van-tag>
                    <van-tag 
                      wx:if="{{book.isNew}}" 
                      type="success" 
                      size="mini" 
                      plain>新书</van-tag>
                  </view>
                  <!-- E right content -->
                  
                </van-cell>
                
              </block>
            </van-cell-group>
            <!-- E wordbook list -->
            
          </van-collapse-item>
          
        </van-collapse>
      </view>
      
      <view style="height: 12px;"></view>
    </block>
    <!-- E wordbook categories -->
    
    <!-- S empty state -->
    <view wx:if="{{isLoaded && wordBookCategories.length === 0}}" class="empty-state">
      <van-empty description="暂无词书数据" />
    </view>
    <!-- E empty state -->
    
    <view style="height: 30px;"></view>
    
  </scroll-view>
  <!-- E scroll-view -->

</view>
<!-- E container -->



<!-- S ace components -->
<ace-navi-bar 
  type="back" 
  title="{{selectedCategoryName || '词书广场'}}" 
  showDivider="{{showNaviBarDivider}}" 
  style="width:100%;position:fixed;top:0;" />
<ace-search-bar 
  wx:if="{{showSearchBar}}" 
  style="position:fixed;z-index:100;width:100%;bottom:{{keyboardHeight}}px;" 
  placeholder="搜索词书" 
  confirmtype="search" 
  bind:focus="onSearchBarFocus" 
  bind:cancel="onSearchBarCancel" 
  bind:confirm="onSearchBarConfirm" />
<dic-card 
  wx:if="{{showDicCard}}" 
  wordInfo="{{wordInfo}}" 
  style="position:fixed;bottom:100px;z-index:20;" 
  showReplaceBtn="{{false}}" 
  showStyleBtn="{{false}}" 
  bind:dicCardEvent="onDicCardEvent" />
<van-overlay 
  show="{{showOverlay}}" 
  bind:click="onClickHideOverlay" />
<!-- E ace components -->

<!-- S vant components -->
<van-toast id="van-toast" />
<van-dialog id="van-dialog" />
<!-- E vant components -->
